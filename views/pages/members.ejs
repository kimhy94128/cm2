<% layout('../layout') %> 

<body>
  <!-- Sidenav -->
  <% include ../partials/sidebar %>
  <!-- Main content -->
  <div class="main-content">
    <!-- Top navbar -->
    <% include ../partials/navbar %>
    <!-- Header -->
    <div class="header bg-gradient-primary pb-8 pt-5 pt-md-8"></div>
    <!-- Page content -->
    <div class="container-fluid mt--7">
      <!-- Table -->
      <div class="row">
        <div class="col">
          <div class="card shadow">
            <div class="card-header border-0">
              <div class="row align-items-center">
                <div class="col-8">
                  <h3 class="mb-0">회원 목록</h3>
                </div>
                <div class="col-4 text-right">
                  <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#regist-modal">
                    신규등록
                  </button>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table align-items-center table-flush">
                <thead class="thead-light">
                  <tr>
                    <th scope="col">이름</th>
                    <th scope="col">생년월일</th>
                    <th scope="col">성별</th>
                    <th scope="col">연락처</th>
                    <th scope="col">등록일</th>
                    <th scope="col">포인트</th>
                    <th scope="col">상태</th>
                  </tr>
                </thead>
                <tbody>
                  <% if(users){ %>
                  <% users.forEach(user => { %>
                    <tr>
                      <td><a href="/users/<%= user.uid %>"><%= user.name %></a></td>
                      <td><%= user.birth %></td>
                      <td><%= user.gender %></td>
                      <td><%= user.phone %></td>
                      <td><%= user.regdate %></td>
                      <td><%= user.point %></td>
                      <td>
                        <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#update-modal-<%= user.uid %>">
                          수정
                        </button>
                      </td>
                    </tr>
                  <% }) %>
                  <% } %> 
                </tbody>
              </table>
            </div>
            <div class="card-footer py-4">
              <nav aria-label="...">
                <ul class="pagination justify-content-end mb-0">
                  <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1">
                      <i class="fas fa-angle-left"></i>
                      <span class="sr-only">Previous</span>
                    </a>
                  </li>
                  <li class="page-item active">
                    <a class="page-link" href="#">1</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#">2 <span class="sr-only">(current)</span></a>
                  </li>
                  <li class="page-item"><a class="page-link" href="#">3</a></li>
                  <li class="page-item">
                    <a class="page-link" href="#">
                      <i class="fas fa-angle-right"></i>
                      <span class="sr-only">Next</span>
                    </a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>

            <!-- 회원등록 모달  -->
            <div class="modal fade" id="regist-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">회원등록</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <form action="/users/regist" method="POST">
                      <div class="row">
                        <div class="col-lg-5">
                          <div class="form-group">
                            <label class="form-control-label" for="input-name">이름</label>
                            <input type="text" id="input-name" class="form-control form-control-alternative" name="name" placeholder="이름" required>
                          </div>
                        </div>
                        <div class="col-lg-5">
                          <div class="form-group">
                            <label class="form-control-label" for="input-name">생년월일</label>
                            <input type="date" id="input-name" class="form-control form-control-alternative" name="birth" placeholder="이름" required>
                          </div>
                        </div>
                        <div class="col-lg-2">
                          <div class="form-group">
                            <label class="form-control-label" for="input-name">성별</label>
                            <div class="custom-control custom-control-alternative custom-radio">
                              <input class="custom-control-input" id="radio1" name="gender" value="남" type="radio">
                              <label class="custom-control-label" for="radio1">남</label>
                            </div>
                            <div class="custom-control custom-control-alternative custom-radio">
                              <input class="custom-control-input" id="radio2" name="gender" value="여" type="radio">
                              <label class="custom-control-label" for="radio2">여</label>
                            </div>
                          </div>
                        </div>  
                        <div class="col-lg-4">
                          <div class="form-group">
                            <label class="form-control-label" for="input-name">연락처</label>
                            <input type="phone" id="input-name" class="form-control form-control-alternative" name="phone" placeholder="연락처" required>
                          </div>
                        </div>
                        <div class="col-lg-4">
                          <div class="form-group">
                            <label class="form-control-label" for="input-name">보호자 성함</label>
                            <input type="text" id="input-name" class="form-control form-control-alternative" name="p_name" placeholder="보호자 성함" required>
                          </div>
                        </div>
                        <div class="col-lg-4">
                          <div class="form-group">
                            <label class="form-control-label" for="input-name">보호자 연락처</label>
                            <input type="phone" id="input-name" class="form-control form-control-alternative" name="p_phone" placeholder="보호자 연락처" required>
                          </div>
                        </div>
                        <div class="col-lg-12">
                          <div class="form-group">
                            <label class="form-control-label" for="input-name">주소</label>
                            <input type="text" id="input-name" class="form-control form-control-alternative" name="address" placeholder="주소" required>
                          </div>
                        </div>
                        <div class="col-lg-6">
                          <div class="form-group">
                            <label class="form-control-label" for="input-name">메모</label>
                            <input type="text" id="input-name" class="form-control form-control-alternative" name="memo" placeholder="메모">
                          </div>
                        </div>
                        <div class="col-lg-6">
                          <div class="form-group">
                            <label class="form-control-label" for="input-name">등록일자</label>
                            <input type="date" id="input-name" class="form-control form-control-alternative" name="regdate" required>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                      <button type="submit" class="btn btn-primary">등록</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            
            <% users.forEach(user => { %>
              <!-- 업데이트 모달  -->
              <div class="modal fade" id="update-modal-<%= user.uid %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">회원등록</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form action="/users/update" method="POST">
                        <input type="hidden" name="uid" value="<%= user.uid %>">
                        <div class="row">
                          <div class="col-lg-5">
                            <div class="form-group">
                              <label class="form-control-label" for="input-name">이름</label>
                              <input type="text" id="input-name" class="form-control form-control-alternative" name="name" placeholder="이름" value="<%= user.name %>" required>
                            </div>
                          </div>
                          <div class="col-lg-5">
                            <div class="form-group">
                              <label class="form-control-label" for="input-name">생년월일</label>
                              <input type="date" id="input-name" class="form-control form-control-alternative" name="birth" placeholder="생년월일" value="<%= user.birth %>" required>
                            </div>
                          </div>
                          <div class="col-lg-2">
                            <div class="form-group">
                              <label class="form-control-label" for="input-name">성별</label>
                              <div class="row">
                              <div class="custom-control custom-radio">
                                <input name="gender" class="custom-control-input" id="customRadio1" type="radio" value="남" <%= user.gender === '남' ? 'checked' : '' %> required>
                                <label class="custom-control-label mr-1" for="customRadio1">남</label>
                              </div>
                              <div class="custom-control custom-radio">
                                <input name="gender" class="custom-control-input" id="customRadio2" type="radio" value="여" <%= user.gender === '여' ? 'checked' : '' %> required>
                                <label class="custom-control-label" for="customRadio2">여</label>
                              </div>
                            </div>  
                            </div>
                          </div>
                          <div class="col-lg-4">
                            <div class="form-group">
                              <label class="form-control-label" for="input-name">연락처</label>
                              <input type="phone" id="input-name" class="form-control form-control-alternative" name="phone" placeholder="연락처" value="<%= user.phone %>" required>
                            </div>
                          </div>
                          <div class="col-lg-4">
                            <div class="form-group">
                              <label class="form-control-label" for="input-name">보호자 성함</label>
                              <input type="text" id="input-name" class="form-control form-control-alternative" name="p_name" placeholder="보호자 성함" value="<%= user.p_name %>" required>
                            </div>
                          </div>
                          <div class="col-lg-4">
                            <div class="form-group">
                              <label class="form-control-label" for="input-name">보호자 연락처</label>
                              <input type="phone" id="input-name" class="form-control form-control-alternative" name="p_phone" placeholder="보호자 연락처" value="<%= user.p_phone %>" required>
                            </div>
                          </div>
                          <div class="col-lg-12">
                            <div class="form-group">
                              <label class="form-control-label" for="input-name">주소</label>
                              <input type="text" id="input-name" class="form-control form-control-alternative" name="address" placeholder="주소" value="<%= user.address %>" required>
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="form-group">
                              <label class="form-control-label" for="input-name">메모</label>
                              <input type="text" id="input-name" class="form-control form-control-alternative" name="memo" placeholder="메모" value="<%= user.memo %>">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="form-group">
                              <label class="form-control-label" for="input-name">등록일자</label>
                              <input type="date" id="input-name" class="form-control form-control-alternative" name="regdate" value="<%= user.regdate %>" required>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                        <button type="submit" class="btn btn-primary">수정</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            <% }) %> 
      
      <!-- Footer -->
      <% include ../partials/footer %>
    </div>
  </div>

  <!-- Include scripts -->
  <% include ../partials/scripts %>
</body>
